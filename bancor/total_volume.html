<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-34871125-3"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34871125-3');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-orange.min.css" />
  <link rel="stylesheet" href="./styles.css" />
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script>
  <title>Bancor Total Trade Volume</title>
</head>
<body style="height:100%">
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-tabs mdl-layout--no-desktop-drawer-button">
    <header class="mdl-layout__header">
      <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
        <a class="mdl-layout__tab" href="./liquidity.html">Liquidity</a>
        <a class="mdl-layout__tab" href="./providers.html">Liquidity Providers</a>
        <a class="mdl-layout__tab" href="./roi.html">ROI</a>
        <a class="mdl-layout__tab is-active" href="#">Trade Volume</a>
        <button class="mdl-button mdl-js-button base-selector" id="usdb-selector">USDB</button>
        <button disabled class="mdl-button mdl-js-button base-selector" id="bnt-selector">BNT</button>
      </div>
    </header>
    <div class="mdl-layout__drawer">
      <nav class="mdl-navigation">
        <a class="mdl-navigation__link" href="./liquidity.html">Liquidity</a>
        <a class="mdl-navigation__link" href="./providers.html">Liquidity Providers</a>
        <a class="mdl-navigation__link" href="./roi.html">ROI</a>
        <a class="mdl-navigation__link" href="#">Trade Volume</a>
        <br>
        <br>
        <button class="mdl-button mdl-js-button base-selector base-selector__mobile" id="usdb-selector-mobile">USDB</button>
        <button disabled class="mdl-button mdl-js-button base-selector base-selector__mobile" id="bnt-selector-mobile">BNT</button>
      </nav>
    </div>
    <main class="mdl-layout__content" style="height:100%">
      <div class="mdl-layout__header-row">
        <div class="mdl-layout-spacer"></div>
        <span class="mdl-layout-title"><h3>Bancor Total Trade Volume</h3></span>
        <div class="mdl-layout-spacer"></div>
      </div>
      <div class="mdl-layout__header-row">
        <div class="mdl-layout-spacer"></div>
        <label id="report" style="font-size: 14pt"></label>
        <div class="mdl-layout-spacer"></div>
      </div>

      <noscript>
        You need to enable JavaScript to run this app.
      </noscript>
      <div id="container" style="height:79%;"></div>

      <script>
        var csv_url = window.location.href;
        csv_url = csv_url.substring(0, csv_url.lastIndexOf('/')) + '/data/bnt/total_volume.csv';
        var selected_currency = 'BNT';

        function selectBNT() {
          selected_currency = 'BNT';
          document.getElementById("bnt-selector").disabled = true;
          document.getElementById("bnt-selector-mobile").disabled = true;
          document.getElementById("usdb-selector").disabled = false;
          document.getElementById("usdb-selector-mobile").disabled = false;
          csv_url = window.location.href;
          csv_url = csv_url.substring(0, csv_url.lastIndexOf('/')) + '/data/bnt/total_volume.csv';
          createChart();
        }

        function selectUSDB() {
          selected_currency = 'USDB';
          document.getElementById("bnt-selector").disabled = false;
          document.getElementById("bnt-selector-mobile").disabled = false;
          document.getElementById("usdb-selector").disabled = true;
          document.getElementById("usdb-selector-mobile").disabled = true;
          csv_url = window.location.href;
          csv_url = csv_url.substring(0, csv_url.lastIndexOf('/')) + '/data/usdb/total_volume.csv';
          createChart();
        }

        document.getElementById("bnt-selector").addEventListener('click', selectBNT);
        document.getElementById("bnt-selector-mobile").addEventListener('click', selectBNT);
        document.getElementById("usdb-selector").addEventListener('click', selectUSDB);
        document.getElementById("usdb-selector-mobile").addEventListener('click', selectUSDB);

        function createChart() {
          Highcharts.stockChart('container', {
            chart: {
              type: 'area',
              backgroundColor: null,
              events: {
                load: function(e) {
                  var chart = this;
                  var button = this.renderer.button('Hide all', 300, 5, function() {
                    var visible = this.text.textStr != 'Hide all';
                    for(var i = 0; i < chart.series.length; i++) {
                      var series = chart.series[i];
                      series.setVisible(visible, false);
                    }
                    this.attr({ text: visible ? 'Hide all' : 'Show all' });
                    chart.redraw();
                  }).add();
                }
              }
            },
            rangeSelector: {
              selected: 2,
              buttons: [{
                type: 'week',
                count: 1,
                text: '1w'
              }, {
                type: 'month',
                count: 1,
                text: '1m'
              }, {
                type: 'month',
                count: 3,
                text: '3m'
              }, {
                type: 'all',
                text: 'All'
              }],
              inputEnabled: true
            },
            title: {
              text: ''
            },
            plotOptions: {
              area: {
                stacking: 'normal'
              }
            },
            legend: {
              enabled: true,
              align: 'center'
            },
            credits: {
              enabled: false
            },
            navigator: {
                enabled: false
            },
            yAxis: {
              opposite: false,
              reversedStacks: false,
              labels: {
                format: '{value} ' + selected_currency
              }
            },
            tooltip: {
             shared: true,
             split: false,
             pointFormat: '<b>{series.name}:</b> {point.y} ({point.percentage:.0f}%)<br>',
             footerFormat: '<b>Total: {point.total:,.0f} </b>'
            },
            scrollbar: {
              barBackgroundColor: '#dee3eb',
              trackBackgroundColor: '#f2f4f7',
              buttonBackgroundColor: '#ffffff',
              buttonArrowColor: '#dee3eb',
              barBorderColor: '#dee3eb',
              buttonBorderColor: '#dee3eb',
              rifleColor: '#ffffff'
            },
            data: {
              csvURL: csv_url
            },
            xAxis: {
              events: {
                afterSetExtremes: function(e) {
                  var chartOb = this;
                  $("#report").html(
                    'Total: <b>' +
                    this.series.reduce(function(a, b) {
                      return a + b.data.reduce(function(a, b) {
                        return a + (b.x >= chartOb.min && b.x <= chartOb.max ? b.y : 0);
                      }, 0);
                    }, 0).toFixed(0) +
                    ' ' + selected_currency + '</b>'
                  );
                }
              }
            }
          });
        }

        createChart();
      </script>
      <footer class="mdl-mini-footer" style="flex: 0 0 auto;padding:15px">
        <div class="mdl-mini-footer__left-section">
          <ul class="mdl-mini-footer__link-list">
            <li><a href="https://etherscan.io/address/0xa1ed93bf44ba35f1e8ebfb4d104a0e109337a5aa">Donations</a></li>
          </ul>
        </div>
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-mini-footer__middle-section">
          <ul class="mdl-mini-footer__link-list">
            <li>ZumZoom Â© 2019</li>
          </ul>
        </div>
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-mini-footer__right-section">
          <ul class="mdl-mini-footer__link-list">
            <li><a href="https://twitter.com/byZumZoom">Twitter</a></li>
            <li><a href="https://github.com/ZumZoom/analytics">GitHub</a></li>
          </ul>
        </div>
      </footer>
    </main>
  </div>
</body>
</html>
