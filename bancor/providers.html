<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-34871125-3"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34871125-3');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-orange.min.css" />
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <title>Bancor Liquidity Providers By Token</title>
</head>
<body style="height:100%">
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-tabs">
    <header class="mdl-layout__header">
      <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
        <a class="mdl-layout__tab" href="./liquidity.html">Liquidity</a>
        <a class="mdl-layout__tab is-active" href="./providers.html">Liquidity Providers</a>
        <a class="mdl-layout__tab" href="./roi.html">ROI</a>
        <a class="mdl-layout__tab" href="./total_volume.html">Trade Volume</a>
      </div>
    </header>
    <main class="mdl-layout__content" style="height: 100%">
      <div class="mdl-layout__header-row">
        <div class="mdl-layout-spacer"></div>
        <span class="mdl-layout-title"><h3>Bancor Liquidity Providers By Token</h3></span>
        <div class="mdl-layout-spacer"></div>
      </div>
      <noscript>
        You need to enable JavaScript to run this app.
      </noscript>

      <div class="mdl-layout__header-row">
        <select id="tokenSelector" class="js-example-basic-single" style="width: 300px; display: inline-block">
          <option value="daibnt">DAIBNT</option>
        </select>
      </div>

      <div id="container" style="height:85%;"></div>


      <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
      <script src="https://code.highcharts.com/stock/highstock.js"></script>
      <script src="https://code.highcharts.com/modules/data.js"></script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
      <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
      <script>
        var csv_url = undefined;

        $(document).ready(function() {
          $('#tokenSelector').select2({
            ajax: {
              url: './data/tokens.json',
              dataType: 'json',
              cache: true,
              processResults: function (data, params) {
                params.term = params.term ? params.term.toLowerCase() : '';
                var newData = { results: data.results.filter(function (el) { return el.id.startsWith(params.term); }) };
                return newData;
              }
            }
          });
          csv_url = window.location.href;
          csv_url = csv_url.substring(0, csv_url.lastIndexOf('/')) + '/data/providers/' + $('#tokenSelector').select2('data')[0].id + '.csv';
          createChart();
        });

        function createChart() {
          Highcharts.chart('container', {
            chart: {
              type: 'pie',
              events: {
                redraw: function(event) {
                  this.renderer.text('<b>Total:</b> ' + this.series[0].total.toFixed(2) + ' BNT', 40, 200)
                               .css({ fontSize: '14px' })
                               .add()
                }
              }
            },
            title: {
              text: '',
              useHTML: true
            },
            credits: {
              enabled: false
            },
            tooltip: {
              pointFormat: '<b>{point.y} BNT ({point.percentage:.0f}%)</b>',
            },
            plotOptions: {
              pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                  enabled: true,
                  format: '<b>{point.name}</b>: {point.y} BNT ({point.percentage:.0f}%)',
                  style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                  },
                }
              }
            },
            data: {
              csvURL: csv_url
            }
          });
        }

        $('#tokenSelector').on('select2:select', function (e) {
          csv_url = window.location.href;
          csv_url = csv_url.substring(0, csv_url.lastIndexOf('/')) + '/data/providers/' + e.params.data.id + '.csv';
          createChart()
        });
      </script>
    </main>
  </div>
</body>
</html>
